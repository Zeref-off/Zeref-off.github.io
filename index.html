<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Escena Cinematográfica</title>
<style>
body{
  margin:0;
  background:#020617;
  overflow:hidden;
  font-family:Arial;
  color:white;
}

/* Pantallas */
.screen{
  position:absolute;
  width:100%;
  height:100%;
  display:none;
}
.active{display:block;}

/* INICIO */
#inicio{
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  background:radial-gradient(circle,#020617,#000);
}
#startBtn{
  padding:15px 40px;
  font-size:24px;
  background:#0ea5e9;
  border:none;
  color:white;
  cursor:pointer;
  border-radius:10px;
}

/* Contador */
#counter{
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  font-size:40px;
}

/* Canvas */
canvas{
  position:absolute;
  top:0;
  left:0;
}

/* Árbol pixel */
#tree{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:220px;
  height:70%;
  image-rendering: pixelated;
}
</style>
</head>
<body>

<!-- INICIO -->
<div id="inicio" class="screen active">
  <h1>INICIO</h1>
  <button id="startBtn">Comenzar</button>
</div>

<!-- Escena Árbol -->
<div id="scene" class="screen">
  <div id="counter">15</div>
  <canvas id="canvas"></canvas>

  <!-- Árbol pixel frondoso -->
  <canvas id="tree"></canvas>
</div>

<script>
const inicio = document.getElementById("inicio");
const scene = document.getElementById("scene");
const counterEl = document.getElementById("counter");
const startBtn = document.getElementById("startBtn");

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

/* -------------------------
   BOTÓN INICIO
------------------------- */
startBtn.onclick = ()=>{
  inicio.classList.remove("active");
  scene.classList.add("active");
  startSequence();
}

/* -------------------------
   ÁRBOL PIXEL REALISTA
------------------------- */
const treeCanvas = document.getElementById("tree");
const tctx = treeCanvas.getContext("2d");

treeCanvas.width = 220;
treeCanvas.height = window.innerHeight*0.7;

function drawTree(){
  const h = treeCanvas.height;

  // Tronco
  tctx.fillStyle="#4b2e1a";
  tctx.fillRect(100,h-200,20,200);

  // Ramas
  for(let i=0;i<6;i++){
    tctx.fillRect(100-(i*10),h-200-(i*30),20+(i*20),10);
  }

  // Hojas frondosas (pixel clusters)
  for(let i=0;i<600;i++){
    const x = 40 + Math.random()*140;
    const y = Math.random()*(h-200);
    const size = 4 + Math.random()*4;
    const green = 120 + Math.random()*80;
    tctx.fillStyle = `rgb(0,${green},0)`;
    tctx.fillRect(x,y,size,size);
  }
}
drawTree();

/* -------------------------
   NIEVE
------------------------- */
let snow=[];
for(let i=0;i<200;i++){
  snow.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    speed:1+Math.random()*2,
    size:1+Math.random()*3
  });
}

/* -------------------------
   PARTÍCULAS
------------------------- */
let particles=[];
let oceanMode=false;
let heartMode=false;
let angle=0;

/* Crear partículas desde árbol */
function dissolveTree(){
  const rect = treeCanvas.getBoundingClientRect();
  for(let i=0;i<3000;i++){
    particles.push({
      x:rect.left + Math.random()*rect.width,
      y:rect.top + Math.random()*rect.height,
      vx:(Math.random()-0.5)*2,
      vy:(Math.random()-0.5)*2,
      z:Math.random()*200
    });
  }
}

/* -------------------------
   CONTADOR
------------------------- */
function startSequence(){
  let time=15;
  const interval=setInterval(()=>{
    time--;
    counterEl.textContent=time;
    if(time<=0){
      clearInterval(interval);
      counterEl.style.display="none";
      dissolveTree();
      setTimeout(()=>oceanMode=true,1000);
      setTimeout(()=>heartMode=true,10000);
    }
  },1000);
}

/* -------------------------
   CORAZÓN 3D
------------------------- */
function heart3D(){
  particles=[];
  for(let t=0;t<Math.PI*2;t+=0.02){
    for(let s=0;s<1;s+=0.1){
      const x=16*Math.pow(Math.sin(t),3);
      const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
      particles.push({
        x:canvas.width/2 + x*20*s,
        y:canvas.height/2 - y*20*s,
        z:(Math.random()-0.5)*200
      });
    }
  }
}

/* -------------------------
   LOOP
------------------------- */
function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* Nieve */
  snow.forEach(s=>{
    ctx.fillStyle="white";
    ctx.fillRect(s.x,s.y,s.size,s.size);
    s.y+=s.speed;
    if(s.y>canvas.height) s.y=0;
  });

  /* Partículas */
  ctx.fillStyle="#38bdf8";

  particles.forEach(p=>{
    if(!heartMode){
      if(oceanMode){
        p.y += Math.sin(p.x*0.01 + Date.now()*0.002);
      }else{
        p.x+=p.vx;
        p.y+=p.vy;
      }
    }else{
      angle+=0.002;
      const cos=Math.cos(angle);
      const sin=Math.sin(angle);

      const x = p.x - canvas.width/2;
      const z = p.z;

      const rx = x*cos - z*sin;
      const rz = x*sin + z*cos;

      const scale = 400/(400+rz);
      p.drawX = canvas.width/2 + rx*scale;
      p.drawY = p.y*scale;
    }

    const dx = heartMode ? p.drawX : p.x;
    const dy = heartMode ? p.drawY : p.y;

    ctx.fillRect(dx,dy,2,2);
  });

  /* Activar corazón */
  if(heartMode && particles.length<2000){
    heart3D();
  }

  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>

